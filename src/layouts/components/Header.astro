---
import { Image } from 'astro:assets';
import HeaderLink from './HeaderLink.astro';
import Avatar from '@src/assets/img/avatar.png';

const navLinks = [
  { href: '/#about', label: 'About' },
  { href: '/#projects', label: 'Projects' },
  { href: '/#experience', label: 'Experience' },
  { href: '/#contact', label: 'Contact' },
];
---

<header class="sticky top-0 z-[999] bg-white transition-colors duration-200 dark:bg-zinc-900">
  <div class="container grid grid-cols-[auto_1fr_auto] items-center gap-4 py-3">
    <a href="/" id="logoLink" class="inline-flex items-center justify-center transition focus-visible:outline-none">
      <span class="sr-only">Hanif Carroll</span>
      <Image src={Avatar} alt="Hanif Carroll" class="h-16 w-16 max-w-none" />
    </a>

    <div class="hidden justify-self-center md:flex">
      <nav class="inline-flex items-center gap-6 rounded-full bg-white px-6 py-2.5 shadow-[0_12px_40px_-25px_rgba(15,23,42,0.85)] transition dark:bg-zinc-900">
        <a href="/" id="homeButton" class="relative inline-flex h-9 w-9 shrink-0 items-center justify-center rounded-full text-zinc-600 transition hover:text-zinc-900 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-zinc-500 dark:text-zinc-300 dark:hover:text-zinc-50 dark:focus-visible:outline-zinc-300">
          <span class="sr-only">Home</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="m3 10.5 9-7 9 7" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 9.75V21h15V9.75" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 21V13.5h4.5V21" />
          </svg>
        </a>
        {
          navLinks.map((link) => (
            <HeaderLink href={link.href}>
              {link.label}
            </HeaderLink>
          ))
        }
      </nav>
    </div>

    <div class="flex items-center justify-end gap-3">
      <button class="inline-flex h-11 w-11 items-center justify-center rounded-full bg-white text-zinc-600 transition hover:text-zinc-900 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-zinc-500 dark:bg-zinc-900 dark:text-zinc-300 dark:hover:text-zinc-50 dark:focus-visible:outline-zinc-300" id="themeToggle" aria-label="Toggle theme">
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="4"></circle>
          <path d="M12 2v2"></path>
          <path d="M12 20v2"></path>
          <path d="m4.93 4.93 1.41 1.41"></path>
          <path d="m17.66 17.66 1.41 1.41"></path>
          <path d="M2 12h2"></path>
          <path d="M20 12h2"></path>
          <path d="m6.34 17.66-1.41 1.41"></path>
          <path d="m19.07 4.93-1.41 1.41"></path>
        </svg>
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
        </svg>
      </button>
      <button class="inline-flex h-11 w-11 items-center justify-center rounded-full bg-white text-zinc-600 transition hover:text-zinc-900 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-zinc-500 dark:bg-zinc-900 dark:text-zinc-300 dark:hover:text-zinc-50 dark:focus-visible:outline-zinc-300 md:hidden" id="mobileMenuToggle" aria-label="Toggle navigation">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="4" x2="20" y1="6" y2="6"></line>
          <line x1="4" x2="20" y1="12" y2="12"></line>
          <line x1="4" x2="20" y1="18" y2="18"></line>
        </svg>
      </button>
    </div>
  </div>

  <div class="bg-white dark:bg-zinc-950 md:hidden" id="mobileMenu" hidden>
    <nav class="container flex flex-col gap-4 py-6 text-base font-medium text-zinc-600 dark:text-zinc-300">
      <a href="/" id="mobileHomeButton" class="inline-flex items-center gap-3 text-zinc-700 transition hover:text-zinc-900 dark:text-zinc-200 dark:hover:text-zinc-50">
        <span class="inline-flex h-9 w-9 items-center justify-center rounded-full text-inherit">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="m3 10.5 9-7 9 7" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 9.75V21h15V9.75" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 21V13.5h4.5V21" />
          </svg>
        </span>
        Home
      </a>
      {
        navLinks.map((link) => (
          <HeaderLink href={link.href}>
            {link.label}
          </HeaderLink>
        ))
      }
    </nav>
  </div>

  <style is:global>
    #themeToggle .moon {
      display: none;
    }
    .dark #themeToggle .sun {
      display: none;
    }
    .dark #themeToggle .moon {
      display: block;
    }
  </style>

  <script is:inline>
    const root = document.documentElement;
    const themeKey = 'theme';

    const initialTheme = (() => {
      const stored = typeof localStorage !== 'undefined' ? localStorage.getItem(themeKey) : null;
      if (stored) return stored;
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    })();

    if (initialTheme === 'dark') {
      root.classList.add('dark');
    } else {
      root.classList.remove('dark');
    }
    localStorage.setItem(themeKey, initialTheme);

    document.getElementById('themeToggle')?.addEventListener('click', () => {
      const isDark = root.classList.toggle('dark');
      localStorage.setItem(themeKey, isDark ? 'dark' : 'light');
    });

    const mobileToggle = document.getElementById('mobileMenuToggle');
    const mobileMenu = document.getElementById('mobileMenu');
    mobileToggle?.addEventListener('click', () => {
      if (!mobileMenu) return;
      const isHidden = mobileMenu.hasAttribute('hidden');
      if (isHidden) {
        mobileMenu.removeAttribute('hidden');
      } else {
        mobileMenu.setAttribute('hidden', 'true');
      }
    });

    // Handle home button and logo clicks to scroll to top if already on homepage
    const handleHomeClick = (e) => {
      const currentPath = window.location.pathname;
      // If we're on the homepage, scroll to top instead of navigating
      if (currentPath === '/') {
        e.preventDefault();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    };

    const logoLink = document.getElementById('logoLink');
    const homeButton = document.getElementById('homeButton');
    const mobileHomeButton = document.getElementById('mobileHomeButton');

    logoLink?.addEventListener('click', handleHomeClick);
    homeButton?.addEventListener('click', handleHomeClick);
    mobileHomeButton?.addEventListener('click', handleHomeClick);
  </script>
</header>
