---
import HeaderLink from "./HeaderLink.astro";

const navLinks = [
    { href: "/#projects", label: "Projects" },
    { href: "/#about", label: "About" },
    { href: "/#experience", label: "Experience" },
];
---

<header
    class="sticky top-0 z-[999] border-b-2 border-black bg-white transition-colors duration-200 dark:border-white dark:bg-black"
>
    <div
        class="container flex items-center justify-between py-4"
    >
        <a
            href="/"
            id="logoLink"
            class="font-mono text-sm font-bold uppercase tracking-widest transition hover:text-primary focus-visible:outline-none"
        >
            [HANIF.DEV]
        </a>

        <nav class="hidden items-center gap-8 md:flex">
            <a
                href="/"
                id="homeButton"
                class="nav-link"
            >
                Home
            </a>
            {
                navLinks.map((link) => (
                    <HeaderLink href={link.href}>{link.label}</HeaderLink>
                ))
            }
            <a href="/#contact" class="btn-primary py-2 px-4">
                Contact
            </a>
        </nav>

        <div class="flex items-center gap-3">
            <button
                class="inline-flex h-10 w-10 items-center justify-center border-2 border-black text-black transition hover:bg-black hover:text-white dark:border-white dark:text-white dark:hover:bg-white dark:hover:text-black"
                id="themeToggle"
                aria-label="Toggle theme"
            >
                <svg
                    class="sun"
                    xmlns="http://www.w3.org/2000/svg"
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <circle cx="12" cy="12" r="4"></circle>
                    <path d="M12 2v2"></path>
                    <path d="M12 20v2"></path>
                    <path d="m4.93 4.93 1.41 1.41"></path>
                    <path d="m17.66 17.66 1.41 1.41"></path>
                    <path d="M2 12h2"></path>
                    <path d="M20 12h2"></path>
                    <path d="m6.34 17.66-1.41 1.41"></path>
                    <path d="m19.07 4.93-1.41 1.41"></path>
                </svg>
                <svg
                    class="moon"
                    xmlns="http://www.w3.org/2000/svg"
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
                </svg>
            </button>
            <button
                class="inline-flex h-10 w-10 items-center justify-center border-2 border-black text-black transition hover:bg-black hover:text-white dark:border-white dark:text-white dark:hover:bg-white dark:hover:text-black md:hidden"
                id="mobileMenuToggle"
                aria-label="Toggle navigation"
            >
                <svg
                    class="menu-icon"
                    xmlns="http://www.w3.org/2000/svg"
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <line x1="4" x2="20" y1="6" y2="6"></line>
                    <line x1="4" x2="20" y1="12" y2="12"></line>
                    <line x1="4" x2="20" y1="18" y2="18"></line>
                </svg>
                <svg
                    class="close-icon hidden"
                    xmlns="http://www.w3.org/2000/svg"
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <path d="M18 6 6 18"></path>
                    <path d="m6 6 12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Mobile Menu - Full screen overlay -->
    <div
        class="fixed inset-0 top-[65px] z-50 bg-white dark:bg-black md:hidden"
        id="mobileMenu"
        hidden
    >
        <nav class="container flex flex-col gap-6 py-8">
            <a
                href="/"
                id="mobileHomeButton"
                class="text-2xl font-bold uppercase tracking-wide transition hover:text-primary"
            >
                Home
            </a>
            {
                navLinks.map((link) => (
                    <a
                        href={link.href}
                        class="text-2xl font-bold uppercase tracking-wide transition hover:text-primary"
                    >
                        {link.label}
                    </a>
                ))
            }
            <a href="/#contact" class="btn-primary mt-4 w-fit">
                Contact
            </a>
        </nav>
    </div>

    <style is:global>
        #themeToggle .moon {
            display: none;
        }
        .dark #themeToggle .sun {
            display: none;
        }
        .dark #themeToggle .moon {
            display: block;
        }
    </style>

    <script is:inline>
        const root = document.documentElement;
        const themeKey = "theme";

        const initialTheme = (() => {
            const stored =
                typeof localStorage !== "undefined"
                    ? localStorage.getItem(themeKey)
                    : null;
            if (stored) return stored;
            return window.matchMedia("(prefers-color-scheme: dark)").matches
                ? "dark"
                : "light";
        })();

        if (initialTheme === "dark") {
            root.classList.add("dark");
        } else {
            root.classList.remove("dark");
        }
        localStorage.setItem(themeKey, initialTheme);

        document
            .getElementById("themeToggle")
            ?.addEventListener("click", () => {
                const isDark = root.classList.toggle("dark");
                localStorage.setItem(themeKey, isDark ? "dark" : "light");
            });

        const mobileToggle = document.getElementById("mobileMenuToggle");
        const mobileMenu = document.getElementById("mobileMenu");
        const menuIcon = mobileToggle?.querySelector(".menu-icon");
        const closeIcon = mobileToggle?.querySelector(".close-icon");

        mobileToggle?.addEventListener("click", () => {
            if (!mobileMenu) return;
            const isHidden = mobileMenu.hasAttribute("hidden");
            if (isHidden) {
                mobileMenu.removeAttribute("hidden");
                menuIcon?.classList.add("hidden");
                closeIcon?.classList.remove("hidden");
            } else {
                mobileMenu.setAttribute("hidden", "true");
                menuIcon?.classList.remove("hidden");
                closeIcon?.classList.add("hidden");
            }
        });

        // Close mobile menu when clicking a link
        mobileMenu?.querySelectorAll("a").forEach((link) => {
            link.addEventListener("click", () => {
                mobileMenu.setAttribute("hidden", "true");
                menuIcon?.classList.remove("hidden");
                closeIcon?.classList.add("hidden");
            });
        });

        // Handle home button and logo clicks to scroll to top if already on homepage
        const handleHomeClick = (e) => {
            const currentPath = window.location.pathname;
            if (currentPath === "/") {
                e.preventDefault();
                window.scrollTo({ top: 0, behavior: "smooth" });
            }
        };

        const logoLink = document.getElementById("logoLink");
        const homeButton = document.getElementById("homeButton");
        const mobileHomeButton = document.getElementById("mobileHomeButton");

        logoLink?.addEventListener("click", handleHomeClick);
        homeButton?.addEventListener("click", handleHomeClick);
        mobileHomeButton?.addEventListener("click", handleHomeClick);
    </script>
</header>
