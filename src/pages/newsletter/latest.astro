---
import { getCollection } from 'astro:content';

// Get the latest newsletter issue
const allWriting = await getCollection('writing');
const latestNewsletter = allWriting
    .filter(entry => entry.data.isNewsletter !== false)
    .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
    .at(0);

// Redirect to the latest newsletter or fallback to /writing
const redirectUrl = latestNewsletter 
    ? `/writing/${latestNewsletter.slug}`
    : '/writing';

return Astro.redirect(redirectUrl, 308);
---