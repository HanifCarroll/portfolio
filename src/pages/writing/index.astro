---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { createPageTitle } from "../../utils/siteConfig";

const pageTitle = createPageTitle("Writing");
const pageDescription =
    "Articles and newsletters about MVP development, product strategy, and building software for bootstrapped nontechnical founders.";

const writingEntries = await getCollection("writing");
const sortedEntries = writingEntries.sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString("en-US", {
        year: "numeric",
        month: "long",
        day: "numeric",
    });
};
---

<BaseLayout title={pageTitle} description={pageDescription} hideFooterCTA={true}>
    <!-- Hero Section -->
    <section class="bg-white text-gray-800">
        <div
            class="container max-w-4xl mx-auto py-20 px-6 md:py-[100px] lg:py-[120px]"
        >
            <div class="text-center mb-16">
                <h1
                    class="text-5xl font-light tracking-tight leading-tight text-gray-900 mb-6 md:text-[2.75rem]"
                >
                    Writing
                </h1>
                <p
                    class="text-xl font-light leading-relaxed text-gray-500 max-w-3xl mx-auto mb-8"
                >
                    Practical insights for bootstrapped nontechnical founders
                    building products users love.
                </p>

                <!-- Top CTA Block (Primary Position) -->
                <div
                    class="flex flex-col sm:flex-row items-center justify-center gap-3"
                >
                    <a
                        href="/newsletter"
                        class="inline-flex items-center px-8 py-3 bg-accent-600 text-white font-medium rounded-full hover:bg-accent-700 transition-all hover:shadow-lg"
                    >
                        Subscribe to the Newsletter
                    </a>
                    <div class="flex items-center gap-3">
                        <a
                            href="/newsletter/latest/"
                            class="inline-flex items-center px-6 py-3 bg-white border border-gray-200 text-gray-700 font-medium rounded-full hover:bg-gray-50 hover:border-gray-300 transition-all"
                        >
                            <span>Latest issue</span>
                            <svg
                                class="w-4 h-4 ml-2"
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                            >
                                <path d="M5 12h14"></path>
                                <path d="m12 5 7 7-7 7"></path>
                            </svg>
                        </a>
                        <a
                            href="/rss.xml"
                            class="inline-flex items-center px-6 py-3 bg-white border border-gray-200 text-gray-700 font-medium rounded-full hover:bg-gray-50 hover:border-gray-300 transition-all"
                            title="RSS Feed"
                        >
                            <svg
                                class="w-4 h-4 mr-2"
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                            >
                                <path d="M4 11a9 9 0 0 1 9 9"></path>
                                <path d="M4 4a16 16 0 0 1 16 16"></path>
                                <circle cx="5" cy="19" r="1"></circle>
                            </svg>
                            <span>RSS</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Articles List -->
            <div class="space-y-12">
                {
                    sortedEntries.map((entry) => (
                        <article class="group">
                            <a href={`/writing/${entry.slug}/`} class="block">
                                <div class="flex items-start justify-between mb-3">
                                    <time class="text-sm font-medium text-accent-600 uppercase tracking-[0.15em]">
                                        {formatDate(entry.data.date)}
                                    </time>
                                    {entry.data.isNewsletter !== false && (
                                        <span class="text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-100 px-3 py-1 rounded-full">
                                            Newsletter
                                        </span>
                                    )}
                                </div>
                                <h2 class="text-2xl font-medium text-gray-900 mb-3 group-hover:text-accent-600 transition-colors">
                                    {entry.data.title}
                                </h2>
                                {entry.data.summary && (
                                    <p class="text-gray-600 leading-relaxed">
                                        {entry.data.summary}
                                    </p>
                                )}
                                <div class="mt-4">
                                    <span class="text-accent-600 font-medium group-hover:underline">
                                        Read more â†’
                                    </span>
                                </div>
                            </a>
                        </article>
                    ))
                }
            </div>

            {
                sortedEntries.length === 0 && (
                    <div class="text-center py-12">
                        <p class="text-gray-500">
                            No articles published yet. Check back soon!
                        </p>
                    </div>
                )
            }

            <!-- Bottom Newsletter CTA -->
            <div
                class="mt-20 p-12 bg-gradient-to-br from-gray-50 to-white rounded-2xl border border-gray-100 text-center"
            >
                <h3 class="text-2xl font-light text-gray-900 mb-4">
                    Never Miss an Issue
                </h3>
                <p class="text-gray-600 mb-8 max-w-md mx-auto">
                    Get practical MVP insights delivered to your inbox every week.
                </p>
                <a
                    href="/newsletter"
                    class="inline-flex items-center px-8 py-3 bg-accent-600 text-white font-medium rounded-full hover:bg-accent-700 transition-all hover:shadow-lg"
                >
                    Subscribe to Newsletter
                </a>
            </div>
        </div>
    </section>
</BaseLayout>
